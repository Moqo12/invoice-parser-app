<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Invoice Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="https://cdn.simplecss.org/simple.min.css" />
  <style>
    body { background:#111; color:#eee; }
    h1,h2 { color:#fff; }
    .toolbar { display:flex; gap:.5rem; flex-wrap:wrap; align-items:center; }
    .filebox { display:flex; gap:.75rem; align-items:center; flex-wrap:wrap; }
    table th, table td { vertical-align: middle; }
    .right { text-align:right; }
    .muted { opacity:.8; }
    .btn { background:orange; color:#111; border:none; padding:.35rem .6rem; cursor:pointer; }
    .btn:hover { filter:brightness(0.95); }
    .btn-ghost { background:transparent; border:1px solid #444; color:#ddd; }
    .btn-danger { background:#e74c3c; color:#fff; border:none; }
    .btn-danger:hover { background:#c0392b; }
    .inline-form { display:inline; margin:0; padding:0; }
  </style>
</head>
<body>
  <header>
    <h1>Invoice Dashboard</h1>
  </header>

  <main>
    <!-- Upload -->
    <section>
      <h2>Upload Invoice</h2>
      <form action="{{ url_for('upload_file') }}" method="post" enctype="multipart/form-data" class="filebox">
        <input type="file" name="file" accept="application/pdf" required />
        <button type="submit" class="btn">Upload</button>
      </form>

      {% with messages = get_flashed_messages(with_categories=false) %}
        {% if messages %}
          <ul>
            {% for m in messages %}
              <li class="muted">{{ m }}</li>
            {% endfor %}
          </ul>
        {% endif %}
      {% endwith %}
    </section>

    <!-- List -->
    <section>
      <h2>Invoices</h2>

      {% if invoices and invoices|length > 0 %}
        <div class="muted">Total: {{ invoices|length }}</div>
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>Supplier</th>
              <th>Invoice #</th>
              <th>Date</th>
              <th class="right">Amount</th>
              <th>Status</th>
              <th style="min-width:220px;">Actions</th>
            </tr>
          </thead>
          <tbody>
          {% for inv in invoices %}
            <tr>
              <td>#{{ inv.id }}</td>
              <td>{{ inv.supplier_name or "—" }}</td>
              <td>{{ inv.invoice_id or "—" }}</td>
              <td>{{ inv.invoice_date or "—" }}</td>
              <td class="right">
                {% if inv.total_amount is not none %}{{ "%.2f"|format(inv.total_amount) }}{% else %}—{% endif %}
              </td>
              <td>{{ inv.status or "—" }}</td>
              <td>
                <div class="toolbar">
                  <a href="{{ url_for('invoice_detail', invoice_id=inv.id) }}"><button class="btn">Open</button></a>
                  <a href="{{ url_for('download_invoice_json', invoice_id=inv.id) }}"><button class="btn btn-ghost">JSON</button></a>
                  <a href="{{ url_for('download_invoice_csv',  invoice_id=inv.id) }}"><button class="btn btn-ghost">CSV</button></a>

                  <!-- Delete (POST) -->
                  <form action="{{ url_for('delete_invoice', invoice_id=inv.id) }}" method="post" class="inline-form"
                        onsubmit="return confirm('Delete invoice #{{ inv.id }}? This cannot be undone.');">
                    <button type="submit" class="btn btn-danger">Delete</button>
                  </form>
                </div>
              </td>
            </tr>
          {% endfor %}
          </tbody>
        </table>
      {% else %}
        <p class="muted">No invoices yet. Upload a PDF to get started.</p>
      {% endif %}
    </section>
  </main>
</body>
</html>
